<!doctype html>
<html>
  <head>
  	<meta charset="utf-8">
  	<title>Processingjs-ES7 test</title>
  </head>
  <body>
    <h1>Processingjs-ES7 test</h1>
    <script src="processing.js"></script>

    <script>
    let TestAPI = {
      getData() {
        return ['a','b','c','d','e'];
      }
    }
    </script>

    <script type="text/processing" id="source">
	    float f = sin(HALF_PI + 0.1);

      void setup() {
        String s = "" + f;
        console.log('s:', s, ', s.contains("e"):', s.contains("e"));
      }
    </script>

    <canvas id="target">
      It would appear your browser does not support the &lt;canvas&gt; element.
    </canvas>

    <script>
    	let code = document.getElementById('source').textContent;

      let target = document.getElementById('target');

      let hooks = {
        preSetup: (...e) => console.log(`presetup ${e}`),
        postSetup: (...e) => console.log(`postsetup ${e}`),
        preDraw: (...e) => console.log(`predraw ${e}`),
        postDraw: (...e) => console.log(`postdraw ${e}`)
      };

    	Processing.parse(code)
    	          .then(ast => Processing.convert(ast))
    	          .then(res => Processing.injectSketch(res, target, {}, hooks))
    	          .catch(error => console.error(error));
    </script>
  </body>
</html>
