<!doctype html>
<html>
  <head>
  	<meta charset="utf-8">
  	<title>Processingjs-ES7 test</title>
  </head>
  <body>
    <h1>Processingjs-ES7 test</h1>
    <script src="processing.js"></script>

    <script>
    let TestAPI = {
      getData() {
        return ['a','b','c','d','e'];
      }
    }
    </script>

    <script type="text/processing" id="source">
      void setup() {
        frameRate(10);
      }

      void draw() {
        console.log(frameCount);
        if (frameCount >= 10) {
          noLoop();
        }
      }
    </script>

    <canvas id="target">
      It would appear your browser does not support the &lt;canvas&gt; element.
    </canvas>

    <script>
    	let code = document.getElementById('source').textContent;

      let target = document.getElementById('target');

      let hooks = {
        // setup hooks
        preSetup: (...e) => console.log(`preSetup ${e}`),
        postSetup: (...e) => console.log(`postSetup ${e}`),
        // draw hooks
        preDraw: (...e) => console.log(`preDraw ${e}`),
        postDraw: (...e) => console.log(`postDraw ${e}`),
        // play hooks
        onFrameStart: (...e) => console.log(`onFrameStart ${e}`),
        onFrameEnd: (...e) => console.log(`onFrameEnd ${e}`),
        onLoop: (...e) => console.log(`onLoop ${e}`),
        onPause: (...e) => console.log(`onPause ${e}`)
      };

    	Processing.parse(code)
    	          .then(ast => Processing.convert(ast))
    	          .then(res => Processing.injectSketch(res, target, {}, hooks))
    	          .catch(error => console.error(error));
    </script>
  </body>
</html>
